#!/usr/bin/env bash

status() {		
   echo "-----> $*"		
}
 
BUILD_DIR=$1
CACHE_DIR=$2

cd $BUILD_DIR

\curl -L https://get.rvm.io | bash -s stable --ruby=2.0.0

# Install compass
status "Installing Compass"
ruby --version
PATH="$(ruby -e 'print Gem.user_dir')/bin:$PATH"
export GEM_HOME=$BUILD_DIR/ruby/.gem/ruby/1.9.1
PATH="$GEM_HOME/bin:$PATH"

if [ ! -f $GEM_HOME/bin/compass ]; then
  mkdir -p $BUILD_DIR/ruby
  HOME="$BUILD_DIR/ruby" ruby install compass -v 1.0.3 --user-install --no-rdoc --no-ri
fi

# Run Grunt
status "Running Grunt"
PATH="$BUILD_DIR/vendor/node/bin:$BUILD_DIR/bin:$BUILD_DIR/node_modules/.bin:$PATH" grunt heroku
